@using Microsoft.AspNetCore.Components.Authorization
@page "/"

<h1>Welcome to ApolloFM</h1>
<p>Connect your Spotify account and share your favorite songs!</p>

@if (!isLoggedIn)
{
	<button class="btn btn-primary" @onclick="Login">Login with Spotify</button>
}
else
{
	<p>Welcome back, @userName!</p>
	<button class="btn btn-secondary" @onclick="Logout">Logout</button>
}

@code {
	private bool isLoggedIn = false;
	private string userName;

	// Inject the AuthenticationStateProvider
	@inject AuthenticationStateProvider AuthenticationStateProvider
	@inject NavigationManager Navigation

	protected override async Task OnInitializedAsync()
	{
		// Check if the user is authenticated
		var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
		var user = authState.User;

		if (user.Identity != null && user.Identity.IsAuthenticated)
		{
			isLoggedIn = true;
			userName = user.Identity.Name ?? "Spotify User";
		}
	}

	private void Login()
	{
		Navigation.NavigateTo("authentication/login");
	}

	private async Task Logout()
	{
		await AuthenticationStateProvider.GetAuthenticationStateAsync();
		Navigation.NavigateTo("authentication/logout");
	}
}