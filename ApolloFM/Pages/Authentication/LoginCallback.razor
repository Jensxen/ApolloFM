@using FM.Application.Services
@inject TokenService TokenService
@inject NavigationManager Navigation

@code {
    protected override async Task OnInitializedAsync()
    {
        try
        {
            var uri = Navigation.ToAbsoluteUri(Navigation.Uri);
            var query = System.Web.HttpUtility.ParseQueryString(uri.Query);
            var token = query["access_token"];
            var expiresIn = int.Parse(query["expires_in"] ?? "3600");

            if (!string.IsNullOrEmpty(token))
            {
                TokenService.SetAccessToken(token, expiresIn);
                Navigation.NavigateTo("/dashboard", forceLoad: true);
            }
            else
            {
                Navigation.NavigateTo("/", forceLoad: true);
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error in LoginCallback: {ex.Message}");
            Navigation.NavigateTo("/", forceLoad: true);
        }
    }
}
